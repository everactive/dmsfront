(this.webpackJsonpwebapp=this.webpackJsonpwebapp||[]).push([[0],{22:function(e,t,a){e.exports=a(55)},47:function(e,t,a){},55:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(18),l=a.n(r),c=a(1),i=a(2),o=a(8),u=a(4),d=a(3),m=100,p=200,h=300,v={1:"waiting",2:"enrolled",3:"disabled"},g={"account-name-desc":"Name of the company","account-code-desc":"Account ID from the Ubuntu Store",accounts:"Accounts",action:"Action",actions:"Actions",active:"Active",address:"Address",brand:"Brand","brand-desc":"Brand ID from the model assertion",cancel:"Cancel",close:"Close",code:"Code","confirm-snap-install":"Enter the snap to install","confirm-user-delete":"Confirm user deletion","copy-device-key":"Copy device public key to clipboard",country:"Country code","country-desc":"SSL certificate country code",created:"Created","current-time":"Current Time","delete-user":"Delete User",description:"Description","device-data":"Device-specific Data","device-detail":"Device Details","device-name-desc":"Unique name of the device",devices:"Devices","devices-connected":"Connected Devices","devices-excluded":"Not in Group",disabled:"Disabled","download-file":"Download File","edit-account":"Edit Account","edit-device":"Edit Device Registration","edit-group":"Edit Device Group","edit-user":"Edit User",email:"Email",enrolled:"Enrolled","error-auth-device":"Invalid device","error-no-auth":"You do not have permissions to access this site. Please login.","error-no-permissions":"You do not have permissions to access this page","error-account-invalid":"Invalid Account","error-user-invalid":"Invalid User","firmware-version":"Firmware Version","group-desc":"Name of a device group",groups:"Groups","hardware-version":"Hardware Version",id:"ID",identity:"Identity",info:"Info","install-on-device":"Install on device","install-snap":"Install a snap","installed-snaps":"Installed Snaps","kernel-version":"Kernel Version",key:"Key","last-update":"Last Update",loading:"Loading...",model:"Model","model-desc":"Model name from the model assertion",modified:"Modified",name:"Name","new-account":"Create New Account","new-device":"New Device Registration","new-group":"New Device Group","new-user":"Create New User","no-accounts":"No accounts registered","no-actions":"No actions found","no-devices":"No devices registered","no-devices-connected":"No devices connected","no-groups":"No groups registered","no-users":"No users registered",ok:"OK","on-classic":"On Classic","os-version":"OS Version",refresh:"Refresh","refresh-snap-list":"Update installed snaps","reg-date":"Registration Date",register:"Register","register-desc":"Devices must be registered with the Identity Service to allow them to connect securely to the cloud services","register-devices":"Registered Devices",registered:"Registered",remove:"Remove",result:"Result",role:"Role",save:"Save","search-store":"search store for snap",serial:"Serial Number","serial-desc":"Serial Number from the serial assertion",series:"Series",settings:"Settings","serial-number":"Serial Number","site-description":"Manage Ubuntu devices connected via the MQTT protocol.",snap:"Snap","snap-store":"Snap Store",snaps:"Snaps","software-version":"Software Version",status:"Status",summary:"Summary","system-info":"System Information","utc-offset":"UTC Offset",timezone:"Timezone",title:"Device Management Service","toggle-status":"Enable/Disable",update:"Update",uptime:"Uptime","user-email-desc":"Email address of the user","user-not-found":"You do not have permissions to access this site","user-name-desc":"Full name of the user","user-username-desc":"Ubuntu SSO name of the user",username:"Username",users:"Users",version:"Version","view-settings":"View configuration",waiting:"Waiting",yes:"Yes"},f=a(19),E=a.n(f),b=a(5),k=a.n(b);var N={baseUrl:window.location.protocol+"//"+window.location.hostname+":"+window.location.port+"/v1/"},y={version:function(e,t){return k.a.get(N.baseUrl+"version")},getToken:function(){return k.a.get(N.baseUrl+"token")},getAuthToken:function(){return k.a.get(N.baseUrl+"authtoken")},accountsList:function(e,t){return k.a.get(N.baseUrl+"organizations")},accountsNew:function(e,t){return k.a.post(N.baseUrl+"organizations",e)},accountsGet:function(e,t){return k.a.get(N.baseUrl+"organizations/"+e)},accountsUpdate:function(e,t,a){return k.a.put(N.baseUrl+"organizations/"+e,t)},accountsForUsers:function(e,t){return k.a.get(N.baseUrl+"users/"+e+"/organizations")},accountsUpdateForUser:function(e,t,a){return k.a.post(N.baseUrl+"users/"+e+"/organizations/"+t)},groupsList:function(e,t){return k.a.get(N.baseUrl+e+"/groups")},groupsGet:function(e,t,a){return k.a.get(N.baseUrl+e+"/groups/"+t)},groupsGetDevices:function(e,t,a){return k.a.get(N.baseUrl+e+"/groups/"+t+"/devices")},groupsGetDevicesExcluded:function(e,t,a){return k.a.get(N.baseUrl+e+"/groups/"+t+"/devices/excluded")},groupsCreate:function(e,t,a){return k.a.post(N.baseUrl+e+"/groups",{orgid:e,name:t})},groupsUpdate:function(e,t,a,n){return k.a.put(N.baseUrl+e+"/groups",{orgid:e,nameFrom:t,nameTo:a})},groupsDeviceLink:function(e,t,a,n){return k.a.post(N.baseUrl+e+"/groups/"+t+"/"+a)},groupsDeviceUnlink:function(e,t,a,n){return k.a.delete(N.baseUrl+e+"/groups/"+t+"/"+a)},snapsList:function(e,t,a){return k.a.get(N.baseUrl+"device/"+e+"/"+t+"/snaps")},snapsInstallRefresh:function(e,t,a){return k.a.post(N.baseUrl+"snaps/"+e+"/"+t.device.deviceId+"/list")},snapsRemove:function(e,t,a,n){return k.a.delete(N.baseUrl+"snaps/"+e+"/"+t.device.deviceId+"/"+a)},snapsInstall:function(e,t,a,n){return k.a.post(N.baseUrl+"snaps/"+e+"/"+t.device.deviceId+"/"+a)},snapsUpdate:function(e,t,a,n,s){return k.a.put(N.baseUrl+"snaps/"+e+"/"+t.device.deviceId+"/"+a+"/"+n)},snapsSettings:function(e,t,a,n){return k.a.get(N.baseUrl+"snaps/"+e+"/"+t.device.deviceId+"/"+a+"/settings")},snapsSettingsUpdate:function(e,t,a,n,s){return k.a.put(N.baseUrl+"snaps/"+e+"/"+t.device.deviceId+"/"+a+"/settings",n)},storeSearch:function(e,t){return k.a.get(N.baseUrl+"store/snaps/"+e)},clientsList:function(e,t,a){return k.a.get(N.baseUrl+e+"/register/devices")},clientsGet:function(e,t,a){return k.a.get(N.baseUrl+e+"/register/devices/"+t)},clientsGetDownloadHREF:function(e,t){return N.baseUrl+e+"/register/devices/"+t+"/download"},clientsNew:function(e,t,a){return k.a.post(N.baseUrl+e+"/register/devices",t)},clientsDeviceObject:function(e,t,a){return k.a.get(N.baseUrl+e+"/clients/"+t+"/device")},clientsUpdate:function(e,t,a,n,s){return k.a.put(N.baseUrl+e+"/register/devices/"+t,{status:a,deviceData:n})},devicesUpdate:function(e,t,a){return k.a.put(N.baseUrl+t.accountCode+"/devices/"+t.id,t)},devicesList:function(e,t){return k.a.get(N.baseUrl+e+"/devices")},devicesGet:function(e,t,a){return k.a.get(N.baseUrl+e+"/devices/"+t)},actionsList:function(e,t,a){return k.a.get(N.baseUrl+e+"/devices/"+t+"/actions")},usersList:function(e,t){return k.a.get(N.baseUrl+"users")},usersNew:function(e,t){return k.a.post(N.baseUrl+"users",e)},usersGet:function(e,t){return k.a.get(N.baseUrl+"users/"+e)},usersUpdate:function(e,t,a){return k.a.put(N.baseUrl+"users/"+e,t)},usersDelete:function(e,t){return k.a.delete(N.baseUrl+"users/"+e)}},w={register:["register","devices"],devices:["info","snaps"],groups:["groups","actions"],actions:["groups","actions"]};function S(e){return g[e]||e}function C(){var e=window.location.pathname.split("/");switch(e.length){case 2:return{section:e[1]};case 3:return{section:e[1],sectionId:e[2]};case 4:return{section:e[1],sectionId:e[2],subsection:e[3]};default:return{}}}function D(e){return function(e){return I(m,e)}(e)}function U(e){return I(p,e)||I(h,e)}function O(e){return I(p,e)}function A(e){return I(h,e)}function j(e){var t;switch(e){case m:t="Standard";break;case p:t="Admin";break;case h:t="Superuser";break;default:t="invalid role"}return t}function I(e,t){return!!t&&(!!t.role&&t.role>=e)}function R(e){var t=S(e.code);return e.message&&(t+=": "+e.message),t}function T(e){sessionStorage.setItem("accountCode",e.orgid),sessionStorage.setItem("accountName",e.name)}function _(){return{orgid:sessionStorage.getItem("accountCode"),name:sessionStorage.getItem("accountName")}}var F=["devices","groups"],x=["devices","groups","accounts"],G=["devices","groups","accounts","users"],L=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"link",value:function(e){return this.props.sectionId?"/"+this.props.section+"/"+this.props.sectionId+"/"+e:"/"+e}},{key:"render",value:function(){var e,t=this,a=this.props.token;if(this.props.links)e=this.props.links;else switch(a.role){case p:e=x;break;case h:e=G;break;case m:e=F;break;default:e=[]}return s.a.createElement("ul",{className:"p-navigation__links",role:"menu"},e.map((function(e){var a="";return t.props.section!==e&&t.props.subsection!==e||(a=" active"),s.a.createElement("li",{key:e,className:"p-navigation__link"+a,role:"menuitem"},s.a.createElement("a",{href:t.link(e)},S(e)))})))}}]),a}(n.Component),z=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(){var e;Object(c.a)(this,a);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(e=t.call.apply(t,[this].concat(s))).handleAccountChange=function(t){t.preventDefault();var a=t.target.value,n=e.props.accounts.filter((function(e){return e.orgid===a}))[0];e.props.onAccountChange(n)},e}return Object(i.a)(a,[{key:"renderAccounts",value:function(e){var t=this;return D(e)?0===this.props.accounts.length?s.a.createElement("span",null):s.a.createElement("li",{className:"p-navigation__link"},s.a.createElement("form",{id:"account-form"},s.a.createElement("select",{value:this.props.selectedAccount.orgid,onChange:this.handleAccountChange},this.props.accounts.map((function(e){return s.a.createElement("option",{key:e.orgid,value:e.orgid,selected:e.orgid===t.props.selectedAccount.orgid},e.name)}))))):s.a.createElement("span",null)}},{key:"renderUser",value:function(e){return D(e)?e.name?s.a.createElement("li",{className:"p-navigation__link"},s.a.createElement("a",{href:"https://login.ubuntu.com/",className:"p-link--external"},e.name)):void 0:s.a.createElement("li",{className:"p-navigation__link"},s.a.createElement("a",{href:"/login",className:"p-link--external"},S("login")))}},{key:"renderUserLogout",value:function(e){if(D(e))return s.a.createElement("li",{className:"p-navigation__link"},s.a.createElement("a",{href:"/logout"},S("logout")))}},{key:"render",value:function(){var e=this.props.token;return s.a.createElement("ul",{className:"p-navigation__links u-float-right"},this.renderAccounts(e),this.renderUser(e),this.renderUserLogout(e))}}]),a}(n.Component),M=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"render",value:function(){return s.a.createElement("header",{className:"p-navigation p-navigation--dark",role:"banner"},s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"p-navigation__banner"},s.a.createElement("div",{className:"p-navigation__logo"},s.a.createElement("div",{className:"nav_logo"},s.a.createElement("a",{className:"p-navigation__link",href:"/"},s.a.createElement("img",{className:"p-navigation__image",src:"https://assets.ubuntu.com/v1/eb4e0ae3-iotdevice.svg",alt:"IoT Management Service"}),"\xa0",s.a.createElement("h3",null,"IoT Management")))),s.a.createElement("a",{href:"#navigation",className:"p-navigation__toggle--open",title:"menu",onClick:this.handleToggleMenu},s.a.createElement("img",{src:"/static/images/navigation-menu-plain.svg",width:"30px",alt:"menu"})),s.a.createElement("nav",{className:"p-navigation__nav"},s.a.createElement("span",{className:"u-off-screen"},s.a.createElement("a",{href:"#navigation"},"Jump to site")),s.a.createElement(L,{section:this.props.section,token:this.props.token}),s.a.createElement(z,{token:this.props.token,accounts:this.props.accounts,selectedAccount:this.props.selectedAccount,onAccountChange:this.props.onAccountChange})))))}}]),a}(n.Component),P=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={version:""},n.getVersion(),n}return Object(i.a)(a,[{key:"getVersion",value:function(){var e=this;y.version().then((function(t){e.setState({version:t.data.version})}))}},{key:"render",value:function(){return s.a.createElement("footer",{className:"spacer"},s.a.createElement("div",null,s.a.createElement("p",null,s.a.createElement("small",null,S("version"),": ",this.state.version))))}}]),a}(n.Component),K=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"render",value:function(){if(this.props.message){var e="p-notification--";return this.props.type?e+=this.props.type:e+="negative",s.a.createElement("div",{className:e},s.a.createElement("p",{className:"p-notification__response"},this.props.message))}return s.a.createElement("span",null)}}]),a}(n.Component),V=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={message:null,accounts:[]},n}return Object(i.a)(a,[{key:"renderTable",value:function(e){return e.length>0?s.a.createElement("div",null,s.a.createElement("table",null,s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",null,S("code")),s.a.createElement("th",null,S("name")))),s.a.createElement("tbody",null,this.renderRows(e)))):s.a.createElement("p",null,S("no-accounts"))}},{key:"renderRows",value:function(e){var t=this;return e.map((function(e){var a=A(t.props.token);return s.a.createElement("tr",{key:e.id},s.a.createElement("td",null,a?s.a.createElement("a",{href:"/accounts/"+e.orgid},e.orgid):e.orgid),s.a.createElement("td",null,e.name))}))}},{key:"render",value:function(){if(!O(this.props.token))return s.a.createElement("div",{className:"row"},s.a.createElement(K,{message:S("error-no-permissions")}));var e=A(this.props.token);return s.a.createElement("div",{className:"row"},s.a.createElement("section",{className:"row"},s.a.createElement("div",null,s.a.createElement("h2",null,S("accounts"),e?s.a.createElement("div",{className:"u-float-right"},s.a.createElement("a",{href:"/accounts/new",className:"p-button--brand",title:S("new-account")},s.a.createElement("i",{className:"fa fa-plus","aria-hidden":"true"}))):"")),s.a.createElement("div",{className:"col-12"},s.a.createElement(K,{message:this.state.message}))),s.a.createElement("section",{className:"row"},this.renderTable(this.props.accounts)))}}]),a}(n.Component),q=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).handleChangeCode=function(e){var t=n.state.account;t.orgid=e.target.value,n.setState({account:t})},n.handleChangeName=function(e){var t=n.state.account;t.name=e.target.value,n.setState({account:t})},n.handleChangeCountry=function(e){n.setState({country:e.target.value})},n.handleSaveClick=function(e){e.preventDefault(),n.props.id?y.accountsUpdate(n.props.id,n.state.account).then((function(e){window.location="/accounts"})).catch((function(e){n.setState({error:R(e.response.data),hideForm:!1})})):y.accountsNew(n.state.account).then((function(e){window.location="/accounts"})).catch((function(e){n.setState({error:R(e.response.data),hideForm:!1})}))},n.state={title:null,error:null,hideForm:!1,account:{active:!0},country:""},n}return Object(i.a)(a,[{key:"componentDidMount",value:function(){this.props.id?(this.setTitle("edit-account"),this.getAccount(this.props.id)):this.setTitle("new-account")}},{key:"getAccount",value:function(e){var t=this;y.accountsGet(e).then((function(e){t.setState({account:e.data.organization})})).catch((function(e){t.setState({error:R(e.response.data),hideForm:!0})}))}},{key:"setTitle",value:function(e){this.setState({title:S(e)})}},{key:"render",value:function(){return A(this.props.token)?this.state.hideForm?s.a.createElement("div",{className:"row"},s.a.createElement(K,{message:this.state.error})):this.props.id&&!this.state.account.orgid?s.a.createElement("div",null):s.a.createElement("div",{className:"row"},s.a.createElement("section",{className:"row"},s.a.createElement("h2",null,this.state.title),s.a.createElement(K,{message:this.state.error}),s.a.createElement("form",null,s.a.createElement("fieldset",null,this.props.id?s.a.createElement("label",{htmlFor:"code"},S("code"),":",s.a.createElement("input",{type:"text",id:"code",disabled:"disabled",value:this.state.account.orgid,onChange:this.handleChangeCode})):"",s.a.createElement("label",{htmlFor:"name"},S("name"),":",s.a.createElement("input",{type:"text",id:"name",placeholder:S("account-name-desc"),value:this.state.account.name,onChange:this.handleChangeName})),this.props.id?"":s.a.createElement("label",{htmlFor:"country"},S("country"),":",s.a.createElement("input",{type:"text",id:"country",placeholder:S("country-desc"),value:this.state.country,onChange:this.handleChangeCountry})))),s.a.createElement("div",null,s.a.createElement("a",{href:"/accounts",className:"p-button--neutral"},S("cancel")),"\xa0",s.a.createElement("a",{href:"/accounts",onClick:this.handleSaveClick,className:"p-button--brand"},S("save")))),s.a.createElement("br",null)):s.a.createElement("div",{className:"row"},s.a.createElement(K,{message:S("error-no-permissions")}))}}]),a}(n.Component),Y=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"render",value:function(){return this.props.message?s.a.createElement("div",{className:"p-card warning"},s.a.createElement("p",null,this.props.message),s.a.createElement("div",null,s.a.createElement("button",{onClick:this.props.handleCancelClick,className:"p-button--neutral small"},S("cancel")),s.a.createElement("button",{onClick:this.props.handleYesClick,className:"p-button--brand small"},S("ok")))):s.a.createElement("span",null)}}]),a}(n.Component),B=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).handleDelete=function(e){e.preventDefault(),n.setState({confirmDelete:e.target.getAttribute("data-key")})},n.handleDeleteUser=function(e){e.preventDefault();var t=n.state.users.filter((function(e){return e.username===n.state.confirmDelete}));0!==t.length&&y.usersDelete(t[0].username).then((function(e){window.location="/users"})).catch((function(e){n.setState({error:R(e.response.data)})}))},n.handleDeleteUserCancel=function(e){e.preventDefault(),n.setState({confirmDelete:null})},n.handleClickAccount=function(e){e.preventDefault();var t=e.target.getAttribute("data-account"),a=parseInt(e.target.getAttribute("data-user"),10),s=e.target.getAttribute("data-username");y.accountsUpdateForUser(s,t).then((function(e){n.getAccountsForUser(s,a)}))},n.showAccounts=function(e){e.preventDefault();var t=parseInt(e.target.getAttribute("data-key"),10),a=e.target.getAttribute("data-user");n.state.showAccountsId===t?n.setState({showAccountsId:null}):n.getAccountsForUser(a,t)},n.state={message:null,users:[],accounts:[],confirmDelete:null,showAccountsId:null},n.getUsers(),n}return Object(i.a)(a,[{key:"getUsers",value:function(){var e=this;y.usersList().then((function(t){e.setState({users:t.data.users})}))}},{key:"getAccountsForUser",value:function(e,t){var a=this;y.accountsForUsers(e).then((function(e){a.setState({accounts:e.data.organizations,showAccountsId:t})}))}},{key:"renderTable",value:function(e){return e.length>0?s.a.createElement("div",null,s.a.createElement("table",null,s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",null),s.a.createElement("th",null,S("username")),s.a.createElement("th",null,S("name")),s.a.createElement("th",null,S("email")),s.a.createElement("th",null,S("role")),s.a.createElement("th",null,S("accounts")))),this.renderRows(e))):s.a.createElement("p",null,S("no-users"))}},{key:"renderActions",value:function(e){return e.username!==this.state.confirmDelete?s.a.createElement("div",null,s.a.createElement("a",{href:"/users/".concat(e.username),className:"p-button--brand small",title:S("edit-user")},s.a.createElement("i",{className:"fa fa-edit"})),"\xa0",s.a.createElement("button",{onClick:this.handleDelete,"data-key":e.username,className:"p-button--neutral small",title:S("delete-user")},s.a.createElement("i",{className:"fa fa-trash","data-key":e.username}))):s.a.createElement(Y,{message:S("confirm-user-delete"),handleYesClick:this.handleDeleteUser,handleCancelClick:this.handleDeleteUserCancel})}},{key:"renderRows",value:function(e){var t=this;return e.map((function(e){var a="";return e.id===t.state.showAccountsId&&(a="borderless"),s.a.createElement("tbody",null,s.a.createElement("tr",{key:e.id,className:a},s.a.createElement("td",null,t.renderActions(e)),s.a.createElement("td",{className:"overflow",title:e.username},e.username),s.a.createElement("td",{className:"overflow",title:e.name},e.name),s.a.createElement("td",{className:"overflow",title:e.email},e.email),s.a.createElement("td",{className:"overflow",title:j(e.role)},j(e.role)),s.a.createElement("td",{className:"overflow"},s.a.createElement("button",{className:"p-button--neutral small",title:S("view-accounts"),"data-key":e.id,"data-user":e.username,onClick:t.showAccounts},s.a.createElement("i",{className:"fa fa-building","aria-hidden":"true","data-key":e.id,"data-user":e.username})))),t.renderAccounts(e))}))}},{key:"renderAccounts",value:function(e){var t=this;if(e.id===this.state.showAccountsId){var a,n=this.state.accounts.map((function(n){return a=n.selected?"p-button--brand":"p-button--neutral",s.a.createElement("button",{key:n.orgid,"data-account":n.orgid,"data-user":e.id,"data-username":e.username,onClick:t.handleClickAccount,className:a},n.name)}));return s.a.createElement("tr",null,s.a.createElement("td",{colSpan:"6"},"Select accounts for ",e.name,":",s.a.createElement("br",null)," ",n))}}},{key:"render",value:function(){return O(this.props.token)?s.a.createElement("div",{className:"row"},s.a.createElement("section",{className:"row"},s.a.createElement("div",null,s.a.createElement("h2",null,S("users"),s.a.createElement("div",{className:"u-float-right"},s.a.createElement("a",{href:"/users/new",className:"p-button--brand",title:S("new-user")},s.a.createElement("i",{className:"fa fa-plus","aria-hidden":"true"}))))),s.a.createElement("div",{className:"col-12"},s.a.createElement(K,{message:this.state.message}))),s.a.createElement("section",{className:"row"},this.renderTable(this.state.users))):s.a.createElement("div",{className:"row"},s.a.createElement(K,{message:S("error-no-permissions")}))}}]),a}(n.Component),J=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).handleChangeUsername=function(e){var t=n.state.user;t.username=e.target.value,n.setState({user:t})},n.handleChangeName=function(e){var t=n.state.user;t.name=e.target.value,n.setState({user:t})},n.handleChangeEmail=function(e){var t=n.state.user;t.email=e.target.value,n.setState({user:t})},n.handleChangeRole=function(e){var t=n.state.user;t.role=parseInt(e.target.value,10),n.setState({user:t})},n.handleSaveClick=function(e){e.preventDefault(),n.props.username?y.usersUpdate(n.props.username,n.state.user).then((function(e){window.location="/users"})).catch((function(e){n.setState({error:R(e.response.data),hideForm:!1})})):y.usersNew(n.state.user).then((function(e){window.location="/users"})).catch((function(e){n.setState({error:R(e.response.data),hideForm:!1})}))},n.state={title:null,user:{},error:null,hideForm:!1},n}return Object(i.a)(a,[{key:"componentDidMount",value:function(){this.props.username?(this.setTitle("edit-user"),this.getUser(this.props.username)):this.setTitle("new-user")}},{key:"setTitle",value:function(e){this.setState({title:S(e)})}},{key:"getUser",value:function(e){var t=this;y.usersGet(e).then((function(e){t.setState({user:e.data.user,hideForm:!1})})).catch((function(e){t.setState({error:R(e.response.data)})}))}},{key:"renderError",value:function(){if(this.state.error)return s.a.createElement(K,{message:this.state.error})}},{key:"render",value:function(){return A(this.props.token)?this.state.hideForm?s.a.createElement("div",{className:"row"},s.a.createElement(K,{message:this.state.error})):s.a.createElement("div",{className:"row"},s.a.createElement("section",{className:"row"},s.a.createElement("h2",null,this.state.title),s.a.createElement(K,{message:this.state.error}),s.a.createElement("form",null,s.a.createElement("fieldset",null,s.a.createElement("label",{htmlFor:"username"},S("username"),":",s.a.createElement("input",{type:"text",id:"username",placeholder:S("user-username-desc"),value:this.state.user.username,onChange:this.handleChangeUsername})),s.a.createElement("label",{htmlFor:"name"},S("name"),":",s.a.createElement("input",{type:"text",id:"name",placeholder:S("user-name-desc"),value:this.state.user.name,onChange:this.handleChangeName})),s.a.createElement("label",{htmlFor:"email"},S("email"),":",s.a.createElement("input",{type:"text",id:"email",placeholder:S("user-email-desc"),value:this.state.user.email,onChange:this.handleChangeEmail})),s.a.createElement("label",{htmlFor:"role"},S("role"),":",s.a.createElement("select",{value:this.state.user.role,id:"role",onChange:this.handleChangeRole},s.a.createElement("option",null),s.a.createElement("option",{key:"standard",value:"100"},"Standard"),s.a.createElement("option",{key:"admin",value:"200"},"Admin"),s.a.createElement("option",{key:"superuser",value:"300"},"Superuser"))))),s.a.createElement("div",null,s.a.createElement("a",{href:"/users",className:"p-button--neutral"},S("cancel")),"\xa0",s.a.createElement("a",{href:"/users",onClick:this.handleSaveClick,className:"p-button--brand"},S("save")))),s.a.createElement("br",null)):s.a.createElement("div",{className:"row"},s.a.createElement(K,{message:S("error-no-permissions")}))}}]),a}(n.Component),H=a(7),W=a.n(H);function Q(e){var t=e.cond,a=e.children;return t?Array.isArray(a)?s.a.createElement("div",null,a):a:null}var X,Z=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"renderActions",value:function(){return this.props.actions&&0!==this.props.actions.length?s.a.createElement("table",{className:"p-card__content"},s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",{className:"small"},S("created")),s.a.createElement("th",{className:"small"},S("modified")),s.a.createElement("th",{className:"small"},S("action")),s.a.createElement("th",{className:"small"},S("status")),s.a.createElement("th",{className:"overflow"},S("result")))),s.a.createElement("tbody",null,this.props.actions.map((function(e){return s.a.createElement("tr",null,s.a.createElement("td",null,W()(e.created).format("llll")),s.a.createElement("td",null,W()(e.modified).format("llll")),s.a.createElement("td",null,e.action),s.a.createElement("td",null,e.status),s.a.createElement("td",null,e.message))})))):s.a.createElement("p",null,S("no-actions"))}},{key:"render",value:function(){var e=this.props.client;return e.device?s.a.createElement("div",{className:"row"},s.a.createElement("h1",{className:"tight"},e.device.brand," ",e.device.model),s.a.createElement("h4",{className:"subtitle"},e.device.serial),s.a.createElement("section",{className:"row spacer"},s.a.createElement("div",{className:"col-12"},s.a.createElement(K,{message:this.props.message}))),s.a.createElement(Q,{cond:!this.props.message},s.a.createElement("section",{className:"row spacer"},s.a.createElement("div",{className:"p-card--highlighted col-6"},s.a.createElement("table",{className:"p-card__content"},s.a.createElement("tbody",null,s.a.createElement("tr",null,s.a.createElement("td",null,S("last-update"),":"),s.a.createElement("td",null,W()(e.device.lastRefresh).format("llll"))),s.a.createElement("tr",null,s.a.createElement("td",null,S("registered"),":"),s.a.createElement("td",null,W()(e.device.created).format("llll"))))))),s.a.createElement("section",{className:"row spacer"},s.a.createElement("div",{className:"p-card"},s.a.createElement("h3",{className:"p-card__title"},S("system-info")),s.a.createElement("table",{className:"p-card__content"},s.a.createElement("tbody",null,s.a.createElement("tr",null,s.a.createElement("td",null,S("model"),":"),s.a.createElement("td",null,e.device.brand," ",e.device.model)),s.a.createElement("tr",null,s.a.createElement("td",null,S("serial-number"),":"),s.a.createElement("td",null,e.device.serial)),s.a.createElement("tr",null,s.a.createElement("td",null,S("os-version"),":"),s.a.createElement("td",null,e.device.version.osId," ",e.device.version.osVersionId)),s.a.createElement("tr",null,s.a.createElement("td",null,S("series"),":"),s.a.createElement("td",null,e.device.version.series)),s.a.createElement("tr",null,s.a.createElement("td",null,S("version"),":"),s.a.createElement("td",null,e.device.version.version)),s.a.createElement("tr",null,s.a.createElement("td",null,S("kernel-version"),":"),s.a.createElement("td",null,e.device.version.kernelVersion)),s.a.createElement("tr",null,s.a.createElement("td",null,S("on-classic"),":"),s.a.createElement("td",null,e.device.version.onClassic?"true":"false")))))),s.a.createElement("section",{className:"row spacer"},s.a.createElement("div",{className:"p-card"},s.a.createElement("h3",{className:"p-card__title"},S("actions")),this.renderActions())))):s.a.createElement("div",null,"Loading...")}}]),a}(n.Component),$=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"getAge",value:function(e){var t=W()(e),a=W()(),n=W.a.duration(a.diff(t)).asMinutes();return n<2?s.a.createElement("i",{className:"fa fa-clock led-green",title:t.format("llll")}):n<5?s.a.createElement("i",{className:"fa fa-clock led-orange",title:t.format("llll")}):s.a.createElement("i",{className:"fa fa-clock led-red",title:t.format("llll")})}},{key:"renderTable",value:function(e){return e.length>0?s.a.createElement("div",null,s.a.createElement("table",null,s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",null,S("brand")),s.a.createElement("th",null,S("model")),s.a.createElement("th",null,S("serial")),s.a.createElement("th",null,S("reg-date")),s.a.createElement("th",null,S("last-update")))),s.a.createElement("tbody",null,this.renderRows(e)))):s.a.createElement("p",null,S("no-devices-connected"))}},{key:"renderRows",value:function(e){var t=this;return e.map((function(e){return s.a.createElement("tr",{key:e.registrationId},s.a.createElement("td",{className:"overflow"},s.a.createElement("a",{href:"/devices/"+e.deviceId+"/info"},e.brand)),s.a.createElement("td",{className:"overflow"},s.a.createElement("a",{href:"/devices/"+e.deviceId+"/info"},e.model)),s.a.createElement("td",{className:"overflow"},s.a.createElement("a",{href:"/devices/"+e.deviceId+"/info"},e.serial)),s.a.createElement("td",{className:"overflow"},W()(e.created).format("lll")),s.a.createElement("td",null,W()(e.lastRefresh).format("lll"),"\xa0",t.getAge(e.lastRefresh)))}))}},{key:"render",value:function(){return s.a.createElement("div",{className:"row"},s.a.createElement("section",{className:"row"},s.a.createElement("h2",null,S("devices-connected")),s.a.createElement("div",{className:"col-12"},s.a.createElement(K,{message:this.props.message}))),s.a.createElement("section",{className:"row spacer"},this.renderTable(this.props.devices)))}}]),a}(n.Component),ee=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).copyToClipboard=function(e){e.preventDefault();var t=document.createElement("textarea");t.value=e.target.getAttribute("data-key"),document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)},n.state={message:null},n}return Object(i.a)(a,[{key:"getStatus",value:function(e){var t=S(v[e]);return 1===e?s.a.createElement("span",null,s.a.createElement("i",{className:"fa fa-clock led-orange",title:t}),"\xa0",t):2===e?s.a.createElement("span",null,s.a.createElement("i",{className:"fa fa-clipboard-check led-green",title:t}),"\xa0",t):s.a.createElement("span",null,s.a.createElement("i",{className:"fa fa-times-circle led-red",title:t}),"\xa0",t)}},{key:"renderTable",value:function(e){if(e)return e.length>0?s.a.createElement("div",null,s.a.createElement("table",null,s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",{className:"small"}),s.a.createElement("th",null,S("id")),s.a.createElement("th",null,S("brand")),s.a.createElement("th",null,S("model")),s.a.createElement("th",null,S("serial")),s.a.createElement("th",{className:"overflow"},S("device-key")),s.a.createElement("th",{className:"xsmall"},S("status")))),s.a.createElement("tbody",null,this.renderRows(e)))):s.a.createElement("p",null,S("no-devices"))}},{key:"renderRows",value:function(e){var t=this;return e.map((function(e){return s.a.createElement("tr",{key:e.id},s.a.createElement("td",null,s.a.createElement("a",{href:"/register/"+e.id,className:"p-button--neutral small"},s.a.createElement("i",{className:"fa fa-edit"})),e.device.deviceKey?s.a.createElement("a",{href:"#",onClick:t.copyToClipboard,"data-key":e.device.deviceKey,className:"p-button--neutral small",title:S("copy-device-key")},s.a.createElement("i",{className:"fa fa-clipboard","data-key":e.device.deviceKey})):""),s.a.createElement("td",{className:"overflow"},e.id),s.a.createElement("td",{className:"overflow"},e.device.brand),s.a.createElement("td",{className:"overflow"},e.device.model),s.a.createElement("td",{className:"overflow"},e.device.serial),s.a.createElement("td",{className:"overflow",title:e.device.deviceKey},e.device.deviceKey&&e.device.deviceKey.substr(0,40)||""),s.a.createElement("td",null,t.getStatus(e.status)))}))}},{key:"render",value:function(){return s.a.createElement("div",{className:"row"},s.a.createElement("section",{className:"row"},s.a.createElement("h2",null,S("register-devices"),U(this.props.token)?s.a.createElement("div",{className:"u-float-right"},s.a.createElement("a",{href:"/register/new",className:"p-button--brand",title:S("new-device")},s.a.createElement("i",{className:"fa fa-plus","aria-hidden":"true"}))):""),s.a.createElement("div",{className:"col-12"},s.a.createElement(K,{message:this.state.message}))),s.a.createElement("section",{className:"row spacer"},this.renderTable(this.props.devices)))}}]),a}(n.Component),te=[{id:1,name:"Waiting"},{id:2,name:"Enrolled"},{id:3,name:"Disabled"}],ae=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).handleChangeBrand=function(e){var t=n.state.device;t.brand=e.target.value,n.setState({device:t})},n.handleChangeModel=function(e){var t=n.state.device;t.model=e.target.value,n.setState({device:t})},n.handleChangeSerial=function(e){var t=n.state.device;t.serial=e.target.value,n.setState({device:t})},n.handleChangeStatus=function(e){var t=parseInt(e.target.value,10);n.setState({statusTo:t})},n.handleSaveClick=function(e){if(e.preventDefault(),n.props.id)y.clientsUpdate(n.props.account.orgid,n.state.deviceId,n.state.statusTo,n.state.deviceData).then((function(e){window.location="/register"})).catch((function(e){n.setState({error:R(e.response.data),hideForm:!1})}));else{var t=n.state.device;t.deviceData=n.state.deviceData,y.clientsNew(n.props.account.orgid,t).then((function(e){window.location="/register"})).catch((function(e){n.setState({error:R(e.response.data),hideForm:!1})}))}},n.handleFileUpload=function(e){var t=new FileReader,a=e.target.files[0];t.onload=function(e){n.setState({deviceData:e.target.result.split(",")[1]})},t.readAsDataURL(a)},n.state={title:null,error:null,hideForm:!1,deviceId:"",status:0,statusTo:0,deviceData:"",device:{orgid:n.props.account.orgid}},n}return Object(i.a)(a,[{key:"componentDidMount",value:function(){this.props.id?(this.setTitle("edit-device"),this.getDevice(this.props.id)):this.setTitle("new-device")}},{key:"getDevice",value:function(e){var t=this;y.clientsGet(this.props.account.orgid,e).then((function(e){t.setState({device:e.data.enrollment.device,status:e.data.enrollment.status,statusTo:e.data.enrollment.status,deviceData:e.data.enrollment.deviceData,deviceId:e.data.enrollment.id})})).catch((function(e){t.setState({error:R(e.response.data),hideForm:!0})}))}},{key:"setTitle",value:function(e){this.setState({title:S(e)})}},{key:"render",value:function(){var e=this;if(!O(this.props.token))return s.a.createElement("div",{className:"row"},s.a.createElement(K,{message:S("error-no-permissions")}));if(this.state.hideForm)return s.a.createElement("div",{className:"row"},s.a.createElement(K,{message:this.state.error}));var t=!!this.state.status;return s.a.createElement("div",{className:"row"},s.a.createElement("section",{className:"row"},s.a.createElement("h2",null,this.state.title),s.a.createElement("div",null,S("register-desc"),s.a.createElement("br",null)),s.a.createElement(K,{message:this.state.error}),s.a.createElement("form",null,s.a.createElement("fieldset",null,this.props.id?s.a.createElement("label",{htmlFor:"id"},S("id"),":",s.a.createElement("input",{type:"text",id:"id",value:this.state.deviceId,disabled:!0})):"",s.a.createElement("label",{htmlFor:"brand"},S("brand"),":",s.a.createElement("input",{type:"text",id:"brand",placeholder:S("brand-desc"),value:this.state.device.brand,onChange:this.handleChangeBrand,disabled:t})),s.a.createElement("label",{htmlFor:"model"},S("model"),":",s.a.createElement("input",{type:"text",id:"model",placeholder:S("model-desc"),value:this.state.device.model,onChange:this.handleChangeModel,disabled:t})),s.a.createElement("label",{htmlFor:"serial"},S("serial"),":",s.a.createElement("input",{type:"text",id:"serial",placeholder:S("serial-desc"),value:this.state.device.serial,onChange:this.handleChangeSerial,disabled:t})),s.a.createElement("label",{htmlFor:"key"},S("device-data"),":",this.state.deviceData?s.a.createElement("a",{href:y.clientsGetDownloadHREF(this.props.account.orgid,this.state.deviceId),className:"p-button--base",title:S("download-file")},s.a.createElement("i",{className:"fa fa-paperclip"})):"",s.a.createElement("input",{type:"file",onChange:this.handleFileUpload,className:"p-button--base"})),s.a.createElement("label",null,this.state.status>0?s.a.createElement("select",{value:this.state.statusTo,onChange:this.handleChangeStatus},te.map((function(t){return s.a.createElement("option",{key:t.id,value:t.id,selected:t.id===e.state.statusTo},t.name)}))):""))),s.a.createElement("div",null,s.a.createElement("a",{href:"/register",className:"p-button--neutral"},S("cancel")),"\xa0",s.a.createElement("a",{href:"/register",onClick:this.handleSaveClick,className:"p-button--brand"},S("save")))),s.a.createElement("br",null))}}]),a}(n.Component),ne=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).pageUp=function(){var e=n.calculatePages(),t=n.state.page+1;t>e&&(t=e),n.setState({page:t}),n.signalPageChange(t)},n.pageDown=function(){var e=n.state.page-1;e<=0&&(e=1),n.setState({page:e}),n.signalPageChange(e)},n.state={page:1,query:null,maxRecords:5|e.pageSize},n}return Object(i.a)(a,[{key:"signalPageChange",value:function(e){var t=(e-1)*this.state.maxRecords;this.props.pageChange(t,t+this.state.maxRecords)}},{key:"calculatePages",value:function(){var e=this.props.displayRows.length,t=parseInt(e/this.state.maxRecords,10);return e%this.state.maxRecords>0&&(t+=1),t}},{key:"renderPaging",value:function(){var e=this.calculatePages();return e>1?s.a.createElement("div",{className:"u-float--right spacer"},s.a.createElement("button",{className:"p-button--neutral small",href:"",onClick:this.pageDown},"\xab"),s.a.createElement("span",null,"\xa0",this.state.page," of ",e,"\xa0"),s.a.createElement("button",{className:"p-button--neutral small",href:"",onClick:this.pageUp},"\xbb")):s.a.createElement("div",{className:"u-float--right"})}},{key:"render",value:function(){return s.a.createElement("div",{className:"col-12"},this.renderPaging())}}]),a}(n.Component),se=a(20),re=a.n(se),le=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).handleSearchChange=function(e){e.preventDefault(),n.setState({snapName:e.target.value})},n.handleKeyPress=function(e){"Enter"===e.key&&n.handleSearchStore(e)},n.handleSearchStore=function(e){e.preventDefault(),n.searchStore()},n.handleInstall=function(e){e.preventDefault();var t=e.target.getAttribute("data-key");n.props.handleInstallClick(t)},n.handleRecordsForPage=function(e,t){n.setState({startRow:e,endRow:t})},n.state={snapName:"",snaps:[],loadingSearch:!1,page:1,startRow:0,endRow:5},n}return Object(i.a)(a,[{key:"searchStore",value:function(){var e=this;0!==this.state.snapName.length&&(this.setState({loadingSearch:!0}),y.storeSearch(this.state.snapName).then((function(t){t.data._embedded&&t.data._embedded["clickindex:package"]&&e.setState({snaps:t.data._embedded["clickindex:package"],loadingSearch:!1,message:null,messageType:null})})))}},{key:"renderSnaps",value:function(e){var t=this;return e.length>0?s.a.createElement("div",null,s.a.createElement("p",null,e.length," snaps found"),s.a.createElement("table",null,s.a.createElement("tbody",null,e.slice(this.state.startRow,this.state.endRow).map((function(e){return s.a.createElement("tr",{key:e.snap_id,title:e.description},s.a.createElement("td",{className:"small"},s.a.createElement("button",{"data-key":e.package_name,className:"p-button--neutral small",title:S("install-on-device"),onClick:t.handleInstall},s.a.createElement("i",{"data-key":e.package_name,className:"fa fa-cloud-upload-alt","aria-hidden":"true"}))),s.a.createElement("td",{className:"overflow"},s.a.createElement("b",null,e.package_name)," ",e.version),s.a.createElement("td",{className:"overflow"},e.developer_name," (",re()(e.binary_filesize),")"))}))))):s.a.createElement("div",null,"No snaps found.")}},{key:"render",value:function(){var e=this.state.snaps;return this.props.message?s.a.createElement("div",{className:"p-card col-4"},s.a.createElement("h3",{className:"p-card__title"},S("snap-store")),s.a.createElement("p",null,this.state.loadingSearch?s.a.createElement("img",{src:"/static/images/ajax-loader.gif",alt:S("loading")}):"",this.props.message),s.a.createElement("p",null,s.a.createElement("form",{className:"p-search-box"},s.a.createElement("input",{className:"p-search-box__input",type:"search",name:"snapname",onKeyPress:this.handleKeyPress,onChange:this.handleSearchChange,placeholder:S("search-store")}),s.a.createElement("button",{type:"reset",className:"p-search-box__reset",alt:"reset"},s.a.createElement("i",{className:"p-icon--close"})),s.a.createElement("button",{type:"submit",onClick:this.handleSearchStore,className:"p-search-box__button",alt:"search"},s.a.createElement("i",{className:"p-icon--search"})))),s.a.createElement(ne,{displayRows:e,pageSize:5,pageChange:this.handleRecordsForPage}),this.renderSnaps(e),s.a.createElement("div",null,s.a.createElement("button",{onClick:this.props.handleCancelClick,className:"p-button--brand"},S("close")))):s.a.createElement("span",null)}}]),a}(n.Component),ce=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).handleRefreshList=function(e){e.preventDefault(),y.snapsInstallRefresh(n.props.account.orgid,n.props.device).then((function(e){n.setState({message:"Sent request to list snaps",messageType:"information"})}))},n.handleInstall=function(e){e.preventDefault(),n.setState({showInstall:!0})},n.handleSnapInstall=function(e){y.snapsInstall(n.props.account.orgid,n.props.device,e).then((function(t){n.setState({message:"Sent request to install snap: "+e,messageType:"information"})}))},n.handleSnapOnChange=function(e){e.preventDefault(),n.setState({snapName:e.target.value})},n.handleRefresh=function(e){e.preventDefault();var t=e.target.getAttribute("data-key");y.snapsUpdate(n.props.account.orgid,n.props.device,t,"refresh").then((function(e){n.setState({message:"Sent request to refresh snap: "+t,messageType:"information"})}))},n.handleToggle=function(e){e.preventDefault();var t=e.target.getAttribute("data-key"),a="enable";"active"===n.findSnap(t).status&&(a="disable"),y.snapsUpdate(n.props.account.orgid,n.props.device,t,a).then((function(e){n.setState({message:"Sent request to enable/disable snap: "+t,messageType:"information"})}))},n.handleRemove=function(e){e.preventDefault();var t=e.target.getAttribute("data-key");y.snapsRemove(n.props.account.orgid,n.props.device,t).then((function(e){n.setState({message:"Sent request to remove snap: "+t,messageType:"information"})}))},n.handleDialogCancel=function(e){e.preventDefault(),n.setState({showInstall:!1})},n.handleShowSettings=function(e){e.preventDefault();var t=e.target.getAttribute("data-key");if(n.state.snapSettings===t)n.setState({snapSettings:null,settings:{}});else{var a=n.findSnap(t);0===a.config.length&&(a.config="{}");var s=JSON.stringify(JSON.parse(a.config),null,2);n.setState({snapSettings:t,settings:s})}},n.handleSettingsChange=function(e){e.preventDefault(),n.setState({settings:e.target.value})},n.handleSettingsUpdate=function(e){e.preventDefault();var t=e.target.getAttribute("data-key");y.snapsSettingsUpdate(n.props.account.orgid,n.props.device,t,n.state.settings).then((function(e){n.setState({snapSettings:null,message:"Sent request to update snap: "+t,messageType:"information"})}))},n.state={message:null,messageType:null,showInstall:!1,snapName:"",snapSettings:null,settings:{},hideForm:!1},n}return Object(i.a)(a,[{key:"findSnap",value:function(e){return this.props.snaps.filter((function(t){return t.name===e}))[0]}},{key:"renderShowInstall",value:function(){if(this.state.showInstall)return s.a.createElement(le,{message:S("confirm-snap-install"),handleTextChange:this.handleSnapOnChange,handleInstallClick:this.handleSnapInstall,handleCancelClick:this.handleDialogCancel})}},{key:"renderSettings",value:function(e){if(e.name===this.state.snapSettings)return s.a.createElement("tr",null,s.a.createElement("td",{colSpan:"6"},s.a.createElement("form",null,s.a.createElement("fieldset",null,s.a.createElement("label",{htmlFor:this.state.snapSettings},"Settings for ",this.state.snapSettings,":",s.a.createElement("textarea",{className:"col-12",rows:"4",value:this.state.settings,"data-key":this.state.snapSettings,onChange:this.handleSettingsChange}))),s.a.createElement("button",{className:"p-button--brand",onClick:this.handleSettingsUpdate,"data-key":e.name},S("update")))))}},{key:"render",value:function(){var e=this,t="",a="";this.state.showInstall&&(t=" col-8",a="hide");var n=this.props.device;return n.device?s.a.createElement("div",{className:"row"},s.a.createElement("h1",{className:"tight"},n.device.orgid," ",n.device.model),s.a.createElement("h4",{className:"subtitle"},n.device.serial),s.a.createElement("section",{className:"row spacer"},s.a.createElement("div",{className:"col-12"},s.a.createElement(K,{message:this.state.message,type:this.state.messageType}))),s.a.createElement(Q,{cond:!this.state.hideForm},s.a.createElement("section",{className:"row spacer"},s.a.createElement("div",{className:"p-card"+t},s.a.createElement("h3",{className:"p-card__title"},S("installed-snaps"),s.a.createElement("div",{className:"u-float-right"},s.a.createElement("button",{onClick:this.handleRefreshList,className:"p-button--brand",title:S("refresh-snap-list")},s.a.createElement("i",{className:"fa fa-sync","aria-hidden":"true"})),s.a.createElement("button",{onClick:this.handleInstall,className:"p-button--brand",title:S("install-snap")},s.a.createElement("i",{className:"fa fa-plus","aria-hidden":"true"})))),s.a.createElement("p",{title:S("last-update")},W()(n.device.lastRefresh).format("llll")),s.a.createElement("table",{className:"p-card__content"},s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",{className:a}),s.a.createElement("th",{className:"small"},S("snap")),s.a.createElement("th",{className:"small"},S("channel")),s.a.createElement("th",null,S("version")),s.a.createElement("th",{className:"xsmall"},S("status")),s.a.createElement("th",{className:"xsmall"},S("settings")))),this.props.snaps.map((function(t){var n="";return t.name===e.state.snapSettings&&(n="borderless"),s.a.createElement("tbody",null,s.a.createElement("tr",{key:t.name,className:n},s.a.createElement("td",{className:a},s.a.createElement("button",{onClick:e.handleRefresh,className:"small u-float",title:S("refresh"),"data-key":t.name},s.a.createElement("i",{className:"fa fa-sync","aria-hidden":"true","data-key":t.name})),s.a.createElement("button",{onClick:e.handleToggle,className:"small",title:S("toggle-status"),"data-key":t.name},s.a.createElement("i",{className:"fa fa-plug","aria-hidden":"true","data-key":t.name})),s.a.createElement("button",{onClick:e.handleRemove,className:"small",title:S("remove"),"data-key":t.name},s.a.createElement("i",{className:"fa fa-times","aria-hidden":"true","data-key":t.name}))),s.a.createElement("td",{title:t.description},t.name),s.a.createElement("td",null,t.channel),s.a.createElement("td",null,t.version),s.a.createElement("td",null,t.status),s.a.createElement("td",null,s.a.createElement("button",{className:"p-button--neutral small",title:S("view-settings"),"data-key":t.name,onClick:e.handleShowSettings},s.a.createElement("i",{className:"fa fa-sliders-h","aria-hidden":"true","data-key":t.name})))),e.renderSettings(t))})))),this.renderShowInstall()))):s.a.createElement("div",null,"Loading...")}}]),a}(n.Component),ie=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).handleGroupClick=function(e){e.preventDefault();var t=e.target.getAttribute("data-key");n.state.name===t?n.setState({name:null,devices:[],devicesExcluded:[]}):(n.setState({name:t}),n.refresh(n.props.account.orgid,t))},n.handleAddToGroup=function(e){e.preventDefault();var t=e.target.getAttribute("data-key");y.groupsDeviceLink(n.props.account.orgid,n.state.name,t).then((function(e){n.refresh(n.props.account.orgid,n.state.name)})).catch((function(e){n.setState({message:R(e.response.data),devicesExcluded:[]})}))},n.handleRemoveFromGroup=function(e){e.preventDefault();var t=e.target.getAttribute("data-key");y.groupsDeviceUnlink(n.props.account.orgid,n.state.name,t).then((function(e){n.refresh(n.props.account.orgid,n.state.name)})).catch((function(e){n.setState({message:R(e.response.data),devicesExcluded:[]})}))},n.state={name:null,devices:[],devicesExcluded:[]},n}return Object(i.a)(a,[{key:"refresh",value:function(e,t){this.getGroupDevices(e,t),this.getGroupExcludedDevices(e,t)}},{key:"getGroupDevices",value:function(e,t){var a=this;y.groupsGetDevices(e,t).then((function(e){a.setState({devices:e.data.devices})})).catch((function(e){a.setState({message:R(e.response.data),devices:[]})}))}},{key:"getGroupExcludedDevices",value:function(e,t){var a=this;y.groupsGetDevicesExcluded(e,t).then((function(e){a.setState({devicesExcluded:e.data.devices})})).catch((function(e){a.setState({message:R(e.response.data),devicesExcluded:[]})}))}},{key:"renderRowsGroups",value:function(e){var t=this;return e.map((function(e){var a=e.name===t.state.name?"p-button--brand":"p-button--neutral";return s.a.createElement("tr",{key:e.name},s.a.createElement("td",{className:"overflow"},s.a.createElement("button",{className:a,onClick:t.handleGroupClick,"data-key":e.name},e.name)))}))}},{key:"renderRowsDevices",value:function(e,t){var a=this;return e.map((function(e){return s.a.createElement("tr",{key:e.deviceId},s.a.createElement("td",{className:"overflow"},t?s.a.createElement("button",{onClick:a.handleAddToGroup,"data-key":e.deviceId,className:"p-button--neutral xsmall"},s.a.createElement("i",{"data-key":e.deviceId,className:"p-icon--plus"})):s.a.createElement("button",{onClick:a.handleRemoveFromGroup,"data-key":e.deviceId,className:"p-button--neutral xsmall"},s.a.createElement("i",{"data-key":e.deviceId,className:"p-icon--close"})),"\xa0",e.brand," ",e.model," ",e.serial))}))}},{key:"renderTableGroups",value:function(e){if(e)return e.length>0?s.a.createElement("div",{className:"col-4"},s.a.createElement("table",null,s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",null,S("groups")))),s.a.createElement("tbody",null,this.renderRowsGroups(e)))):s.a.createElement("p",null,S("no-groups"))}},{key:"renderTableDevices",value:function(e){if(e)return e.length>0?s.a.createElement("div",{className:"col-4"},s.a.createElement("table",null,s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",null,S("devices")))),s.a.createElement("tbody",null,this.renderRowsDevices(e,!1)))):s.a.createElement("div",{className:"col-4"},s.a.createElement("table",null,s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",null,S("devices")))),s.a.createElement("tbody",null,s.a.createElement("tr",null,s.a.createElement("td",null,S("no-devices"))))))}},{key:"renderTableDevicesExcluded",value:function(e){if(e)return e.length>0?s.a.createElement("div",{className:"col-3"},s.a.createElement("table",null,s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",null,S("devices-excluded")))),s.a.createElement("tbody",null,this.renderRowsDevices(e,!0)))):s.a.createElement("div",{className:"col-4"},s.a.createElement("table",null,s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",null,S("devices-excluded")))),s.a.createElement("tbody",null,s.a.createElement("tr",null,s.a.createElement("td",null,S("no-devices"))))))}},{key:"render",value:function(){return s.a.createElement("div",{className:"row"},s.a.createElement("section",{className:"row"},s.a.createElement("h2",null,S("groups"),U(this.props.token)?s.a.createElement("div",{className:"u-float-right"},s.a.createElement("a",{href:"/groups/new",className:"p-button--brand",title:S("new-group")},s.a.createElement("i",{className:"fa fa-plus","aria-hidden":"true"}))):""),s.a.createElement("div",{className:"col-12"},s.a.createElement(K,{message:this.props.message}))),s.a.createElement("section",{className:"row spacer"},this.renderTableGroups(this.props.groups),this.state.name?this.renderTableDevices(this.state.devices):"",this.state.name?this.renderTableDevicesExcluded(this.state.devicesExcluded):""))}}]),a}(n.Component),oe=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).handleGroupClick=function(e){e.preventDefault();var t=e.target.getAttribute("data-key");n.state.name===t?n.setState({name:null,devices:[],devicesExcluded:[]}):(n.setState({name:t}),n.refresh(n.props.account.orgid,t))},n.state={name:null,groups:[],actions:[]},n}return Object(i.a)(a,[{key:"refresh",value:function(e,t){}},{key:"renderRowsGroups",value:function(e){var t=this;return e.map((function(e){var a=e.name===t.state.name?"p-button--brand":"p-button--neutral";return s.a.createElement("tr",{key:e.name},s.a.createElement("td",{className:"overflow"},s.a.createElement("button",{className:a,onClick:t.handleGroupClick,"data-key":e.name},e.name)))}))}},{key:"renderTableGroups",value:function(e){if(e)return e.length>0?s.a.createElement("div",{className:"col-4"},s.a.createElement("table",null,s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",null,S("groups")))),s.a.createElement("tbody",null,this.renderRowsGroups(e)))):s.a.createElement("p",null,S("no-groups"))}},{key:"render",value:function(){return s.a.createElement("div",{className:"row"},s.a.createElement("section",{className:"row"},s.a.createElement("h2",null,S("groups")),s.a.createElement("div",{className:"col-12"},s.a.createElement(K,{message:this.props.message}))),s.a.createElement("section",{className:"row spacer"},this.renderTableGroups(this.props.groups)))}}]),a}(n.Component),ue=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).handleChangeName=function(e){n.setState({nameTo:e.target.value})},n.handleSaveClick=function(e){e.preventDefault(),n.props.name?y.groupsUpdate(n.props.account.orgid,n.props.name,n.state.nameTo).then((function(e){window.location="/groups"})).catch((function(e){n.setState({error:R(e.response.data),hideForm:!1})})):y.groupsCreate(n.props.account.orgid,n.state.nameTo).then((function(e){window.location="/groups"})).catch((function(e){n.setState({error:R(e.response.data),hideForm:!1})}))},n.state={title:null,error:null,hideForm:!1,nameTo:""},n}return Object(i.a)(a,[{key:"componentDidMount",value:function(){this.props.name?(this.setTitle("edit-group"),this.getGroup(this.props.account.orgid,this.props.name)):this.setTitle("new-group")}},{key:"getGroup",value:function(e,t){var a=this;y.groupsGet(e,t).then((function(e){a.setState({group:e.data.group,nameTo:e.data.group.name})})).catch((function(e){a.setState({error:R(e.response.data),hideForm:!0})}))}},{key:"setTitle",value:function(e){this.setState({title:S(e)})}},{key:"render",value:function(){if(!O(this.props.token))return s.a.createElement("div",{className:"row"},s.a.createElement(K,{message:S("error-no-permissions")}));if(this.state.hideForm)return s.a.createElement("div",{className:"row"},s.a.createElement(K,{message:this.state.error}));var e=!!this.state.status;return s.a.createElement("div",{className:"row"},s.a.createElement("section",{className:"row"},s.a.createElement("h2",null,this.state.title),s.a.createElement(K,{message:this.state.error}),s.a.createElement("form",null,s.a.createElement("fieldset",null,s.a.createElement("label",{htmlFor:"name"},S("name"),":",s.a.createElement("input",{type:"text",id:"name",placeholder:S("group-desc"),value:this.state.name,onChange:this.handleChangeName,disabled:e})))),s.a.createElement("div",null,s.a.createElement("a",{href:"/groups",className:"p-button--neutral"},S("cancel")),"\xa0",s.a.createElement("a",{href:"/groups",onClick:this.handleSaveClick,className:"p-button--brand"},S("save")))),s.a.createElement("br",null))}}]),a}(n.Component),de=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).handleLogin=function(e){window.location.pathname="/login"},n.state={token:e.token||{}},n}return Object(i.a)(a,[{key:"renderUser",value:function(){return D(this.props.token)?s.a.createElement("div",null):s.a.createElement("div",null,s.a.createElement("button",{onClick:this.handleLogin,className:"p-button--brand"},S("login")))}},{key:"renderError",value:function(){if(this.props.error)return s.a.createElement(K,{message:S("user-not-found")})}},{key:"render",value:function(){return s.a.createElement("div",{className:"row"},s.a.createElement("section",{className:"row"},s.a.createElement("h2",null,S("title")),s.a.createElement("h3",null,this.props.account.name),this.renderError(),s.a.createElement("div",null,s.a.createElement("div",{className:"p-card"},S("site-description")))),s.a.createElement("section",{className:"row spacer"},this.renderUser()))}}]),a}(n.Component),me=(a(47),a(21)),pe=a.n(me)()(),he=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).handleAccountChange=function(e){T(e),n.setState({selectedAccount:e}),n.updateDataForRoute(e,!0)},n.handleLogin=function(e){window.location.pathname="/login"},n.state={location:pe.location,token:e.token||{},accounts:[],selectedAccount:_()||{},reg_devices:[],devices:[],groups:[],clients:[],client:{},clientObject:{},snaps:[],actions:[]},pe.listen(n.handleNavigation.bind(Object(o.a)(n))),n.getAccounts(),n}return Object(i.a)(a,[{key:"handleNavigation",value:function(e){this.setState({location:e}),window.scrollTo(0,0)}},{key:"getAccounts",value:function(){var e=this;D(this.props.token)&&y.accountsList().then((function(t){var a=e.state.selectedAccount;_().orgid&&"undefined"!==_().orgid||t.data.organizations.length>0&&T(a=t.data.organizations[0]),e.setState({accounts:t.data.organizations,selectedAccount:a}),e.updateDataForRoute(a,!1)}))}},{key:"getRegisteredDevices",value:function(e){var t=this;y.clientsList(e).then((function(e){t.setState({reg_devices:e.data.devices})}))}},{key:"getDevices",value:function(e){var t=this;y.devicesList(e).then((function(e){t.setState({devices:e.data.devices})}))}},{key:"getClient",value:function(e,t){var a=this;y.devicesGet(e,t).then((function(e){a.setState({client:e.data})})).catch((function(e){a.setState({message:R(e.response.data),client:{}})}))}},{key:"getGroups",value:function(e){var t=this;y.groupsList(e).then((function(e){t.setState({groups:e.data.groups})})).catch((function(e){t.setState({message:R(e.response.data),groups:[]})}))}},{key:"getSnaps",value:function(e,t){var a=this;y.snapsList(e,t).then((function(e){a.setState({snaps:e.data.snaps})})).catch((function(e){a.setState({message:R(e.response),snaps:[]})}))}},{key:"getActions",value:function(e,t){var a=this;y.actionsList(e,t).then((function(e){a.setState({actions:e.data.actions})})).catch((function(e){console.log("---",e),a.setState({message:R(e.response),actions:[]})}))}},{key:"updateDataForRoute",value:function(e,t){var a=C();t&&"clients"===a.section&&a.sectionId?window.location="/clients":("register"===a.section&&this.getRegisteredDevices(e.orgid),"devices"===a.section&&this.getDevices(e.orgid),"devices"===a.section&&a.sectionId&&this.getClient(e.orgid,a.sectionId),"devices"===a.section&&a.sectionId&&this.getActions(e.orgid,a.sectionId),"devices"===a.section&&a.sectionId&&"snaps"===a.subsection&&this.getSnaps(e.orgid,a.sectionId),"groups"===a.section&&this.getGroups(e.orgid),"actions"===a.section&&this.getGroups(e.orgid))}},{key:"renderAccounts",value:function(e,t){if(!e)return s.a.createElement(V,{token:this.props.token,accounts:this.state.accounts});switch(e){case"new":return s.a.createElement(q,{token:this.props.token});default:return s.a.createElement(q,{token:this.props.token,id:e})}}},{key:"renderUsers",value:function(e,t){if(!e)return s.a.createElement(B,{token:this.props.token});switch(e){case"new":return s.a.createElement(J,{token:this.props.token});default:return s.a.createElement(J,{token:this.props.token,username:e})}}},{key:"renderDevices",value:function(e,t){if(!e)return s.a.createElement($,{token:this.props.token,devices:this.state.devices,account:this.state.selectedAccount});switch(t){case"snaps":return s.a.createElement(ce,{token:this.props.token,endpoint:e,account:this.state.selectedAccount,device:this.state.client,snaps:this.state.snaps});default:return s.a.createElement(Z,{token:this.props.token,endpoint:e,message:this.state.message,actions:this.state.actions,client:this.state.client,clientObject:this.state.clientObject,account:this.state.selectedAccount})}}},{key:"renderRegister",value:function(e,t){if(!e)return s.a.createElement(ee,{token:this.props.token,devices:this.state.reg_devices,account:this.state.selectedAccount});switch(e){case"new":return s.a.createElement(ae,{token:this.props.token,account:this.state.selectedAccount});default:return s.a.createElement(ae,{token:this.props.token,account:this.state.selectedAccount,id:e})}}},{key:"renderGroups",value:function(e,t){if(!e)return s.a.createElement(ie,{token:this.props.token,groups:this.state.groups,account:this.state.selectedAccount});switch(e){case"new":return s.a.createElement(ue,{token:this.props.token,account:this.state.selectedAccount});default:return s.a.createElement(ue,{token:this.props.token,account:this.state.selectedAccount,name:e})}}},{key:"renderActions",value:function(e,t){if(!e)return s.a.createElement(oe,{token:this.props.token,groups:this.state.groups,account:this.state.selectedAccount})}},{key:"renderSubnav",value:function(e,t,a){var n=function(e,t){if(""!==e)return"devices"!==e||t?w[e]:w.register}(e,t);return n?s.a.createElement("div",{className:"subnav"},s.a.createElement("nav",{className:"p-navigation__nav p-navigation--light",role:"menubar"},s.a.createElement(L,{links:n,section:e,sectionId:t,subsection:a,token:this.props.token}))):s.a.createElement("span",null)}},{key:"render",value:function(){var e=C();return console.log(e),console.log("---account",this.state.selectedAccount),s.a.createElement("div",{className:"App"},s.a.createElement(M,{token:this.props.token,section:e.section,accounts:this.state.accounts,selectedAccount:this.state.selectedAccount,onAccountChange:this.handleAccountChange}),s.a.createElement("section",{className:"p-strip--image is-shallow snapcraft-banner-background"},s.a.createElement("div",{className:"row"})),s.a.createElement(Q,{cond:D(this.props.token)},this.renderSubnav(e.section,e.sectionId,e.subsection)),s.a.createElement(Q,{cond:D(this.props.token)},s.a.createElement("div",{className:"page-content"},""===e.section?s.a.createElement(de,{token:this.props.token,account:this.state.selectedAccount}):"","notfound"===e.section?s.a.createElement(de,{token:this.props.token,error:!0}):"","devices"===e.section?this.renderDevices(e.sectionId,e.subsection):"","register"===e.section?this.renderRegister(e.sectionId,e.subsection):"","groups"===e.section?this.renderGroups(e.sectionId,e.subsection):"","accounts"===e.section?this.renderAccounts(e.sectionId,e.subsection):"","users"===e.section?this.renderUsers(e.sectionId,e.subsection):"","actions"===e.section?this.renderActions(e.sectionId,e.subsection):"")),s.a.createElement(Q,{cond:!D(this.props.token)},s.a.createElement("div",{className:"page-content"},s.a.createElement("div",{className:"row"},s.a.createElement(K,{message:S("error-no-auth")}),s.a.createElement("button",{onClick:this.handleLogin,className:"p-button--brand col-1"},S("login"))))),s.a.createElement(P,null))}}]),a}(n.Component);X=function(e){l.a.render(s.a.createElement(he,{token:e}),document.getElementById("root"))},y.getAuthToken().then((function(e){var t=e.headers.authorization;if(t){var a=E()(t);X(a||{})}else X({})}))}},[[22,1,2]]]);
//# sourceMappingURL=main.8ca24fda.chunk.js.map